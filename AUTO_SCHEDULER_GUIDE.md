# 🕘 자동 스케줄링 시스템 가이드

## 📋 개요

Twitter 데이터 수집이 **매일 오전 9시에 자동으로 실행**되도록 설정되었습니다.

---

## ⚙️ **설정 내용**

### **1. Vercel Cron Jobs 설정**

```json
// vercel.json
{
  "crons": [
    {
      "path": "/api/twitter-scheduler/cron",
      "schedule": "0 9 * * *"
    }
  ]
}
```

**스케줄 설명**:
- `0 9 * * *`: 매일 오전 9시 (한국시간)
- Cron 표현식: `분 시 일 월 요일`

### **2. 자동 실행 API**

**엔드포인트**: `/api/twitter-scheduler/cron`
- **실행 시간**: 매일 오전 9:00 AM (KST)
- **기능**: 등록된 모든 Twitter 계정 데이터 자동 수집
- **안전장치**: API 제한 확인 후 실행

---

## 🎯 **자동 실행 프로세스**

### **실행 순서**:
1. **시간 확인**: 매일 오전 9시 정각
2. **API 사용량 확인**: 월 1,000회 제한 체크
3. **일일 제한 확인**: 일 30회 안전 제한 체크
4. **계정 선택**: 우선순위 기반 스마트 선택
5. **데이터 수집**: Twitter API 호출하여 최신 트윗 수집
6. **DB 저장**: 수집된 데이터를 Supabase에 저장
7. **로그 기록**: 수집 결과 및 통계 저장

### **스마트 최적화**:
- **우선순위 순서**: 팔로워 수 많은 계정부터
- **API 절약**: 일일 제한 도달 시 자동 중단
- **오류 처리**: 실패한 계정 건너뛰고 계속 진행
- **중복 방지**: 이미 수집된 트윗 제외

---

## 📊 **모니터링 및 확인**

### **1. 관리자 대시보드에서 확인**
```
/admin → 스케줄러 관리
```

**표시 정보**:
- ✅ **자동 스케줄링 활성화** 상태
- 🕘 **다음 실행 시간**: 내일 오전 9:00 AM
- 📈 **API 사용량**: 실시간 추적
- 📋 **마지막 수집 결과**: 성공/실패 내역

### **2. 실행 로그 확인**

**Vercel 함수 로그**에서 확인 가능:
```
🕘 자동 스케줄링 시작 - 오전 9시 정기 수집
📅 실행 시간: 2025-01-28 09:00:00
📊 현재 API 사용량: 245/1000
🎯 수집 대상: 5개 계정
✅ 자동 수집 완료: 5/5 성공
```

### **3. 수집된 데이터 확인**

**메인 페이지**에서 프로젝트별로 확인:
```
프로젝트 선택 → Twitter 분석 탭 → AI 분석 결과
```

---

## 🔧 **수동 실행도 가능**

자동 스케줄링과 별개로 **수동 실행**도 언제든 가능합니다:

```
/admin → 스케줄러 관리 → "🚀 지금 수집 (수동)" 버튼
```

**수동 vs 자동**:
- **자동**: 매일 오전 9시, 일관성 있는 데이터 수집
- **수동**: 필요할 때 즉시, 중요한 이벤트 대응

---

## ⚠️ **주의사항**

### **1. API 제한 관리**
- **월 제한**: 1,000회 (RapidAPI Basic 플랜)
- **일일 안전 제한**: 30회
- **자동 중단**: 제한 도달 시 자동으로 수집 중단

### **2. 데이터 품질**
- **중복 제거**: 같은 트윗은 한 번만 저장
- **실시간성**: 매일 수집으로 최신 상태 유지
- **히스토리**: 시간이 지나면서 6개월+ 데이터 자동 누적

### **3. 오류 대응**
- **자동 복구**: 일시적 오류 시 다음 날 재시도
- **로그 기록**: 모든 오류 상황 기록 및 추적
- **우아한 실패**: 일부 계정 실패해도 나머지 계속 진행

---

## 🎉 **장점**

### **✅ 일관성**
- 매일 같은 시간에 수집
- 안정적인 데이터 품질

### **✅ 효율성**
- 관리자 개입 불필요
- API 사용량 최적화

### **✅ 확장성**
- 계정 추가 시 자동으로 포함
- 우선순위 기반 스마트 관리

### **✅ 신뢰성**
- Vercel의 안정적인 인프라
- 오류 처리 및 복구 메커니즘

---

## 🔄 **다음 단계**

1. **배포 후 확인**: 첫 번째 자동 실행 모니터링
2. **성능 튜닝**: API 사용량 패턴 분석 후 최적화
3. **알림 시스템**: 수집 실패 시 관리자 알림 (향후 구현)
4. **대시보드 확장**: 더 상세한 통계 및 트렌드 분석

---

**설정 완료일**: 2025-01-28  
**첫 자동 실행**: 2025-01-29 오전 9:00 AM  
**상태**: ✅ 활성화됨
